# 公開前テスト計画: 一人で全フローを検証する方法

## テスト環境の準備

### 2ユーザーのシミュレーション方法
- **ユーザーA**: Chrome 通常ウインドウ
- **ユーザーB**: Chrome シークレットウインドウ（または Safari）
- それぞれ別の匿名セッションが発行されるので、別ユーザーとして動作する

### GPS偽装 (Chrome DevTools)
1. DevTools を開く（F12 / Cmd+Option+I）
2. `...` メニュー → **More tools** → **Sensors**
3. **Location** ドロップダウン → **Other...** を選択
4. 緯度・経度を手入力（イベントの会場座標 ± 微調整）

---

## テスト用データの例

**ユーザーA（譲: バッジA×2、求: バッジB×1）**
**ユーザーB（譲: バッジB×1、求: バッジA×1）**
→ マッチが成立するはず

**ユーザーAに追加（譲: バッジC×1、求: アクスタA×1）**
→ Bが持っていないのでこのセットはマッチしない → 一部マッチの確認

---

## Phase 1: 座標なしイベントで機能テスト

管理画面でテストイベントを作成（会場座標なし、登録期間・交換期間は現在を含むよう設定）

### 基本フロー
- [ ] トップページ → ニックネーム入力 → イベント選択（ユーザーA）
- [ ] シークレットウインドウで同じ手順（ユーザーB）
- [ ] グッズ登録: 譲・求それぞれ登録（ユーザーA）
- [ ] グッズ登録: Aの求がBの譲、Bの求がAの譲になるよう登録（ユーザーB）
- [ ] マッチング開始 → 相手が表示される（両ユーザー）
- [ ] 交換リクエスト送信（ユーザーA → B）
- [ ] リクエスト通知表示＋音・振動（ユーザーB）
- [ ] リクエスト承認 → 識別画面に遷移（ユーザーB）
- [ ] 識別画面: 同じカラーが表示される（両ユーザー）
- [ ] チャット送受信（両方向）
- [ ] 交換完了ボタン → 完了表示

### エッジケース
- [ ] マッチなし状態の表示（グッズが噛み合わない場合）
- [ ] 交換リクエスト拒否 → マッチング画面に戻る
- [ ] データ全削除 → トップに戻る＆DBからデータ消去
- [ ] 一部マッチ（全部ではなく一部条件が合うケース）

### 管理画面
- [ ] イベント作成・編集・有効/無効切り替え
- [ ] グッズ作成（ファイルアップロード / URL+切り抜き）
- [ ] グッズ一括登録
- [ ] グッズ編集・削除
- [ ] グッズリクエスト確認・承認

### 静的ページ
- [ ] 使い方ガイド（/guide）の表示
- [ ] データの取り扱い（/privacy）の表示
- [ ] イベント直リンク（/e/[eventId]）→ ニックネーム入力 → イベント直行
- [ ] 全ページのフッターリンク動作

---

## Phase 2: 座標ありイベントで位置テスト

管理画面でテストイベントの会場座標を自宅付近に設定（半径1km程度）

### 位置チェック
- [ ] DevTools Sensors で会場エリア内の座標を設定 → マッチング開始できる
- [ ] DevTools Sensors で会場エリア外の座標を設定 → 「エリア外」表示になる
- [ ] エリア内→外に移動 → is_active が false になりマッチ対象から外れる
- [ ] エリア外→内に移動 → is_active が true に復帰
- [ ] 地図に自分と相手の位置が表示される

### 期間チェック
- [ ] 登録可能期間外 → 「登録期間外です」表示、グッズ登録不可
- [ ] 交換可能期間外 → マッチング開始不可
- [ ] 登録可能期間内・交換可能期間内 → 正常動作

---

## Phase 3: モバイル実機テスト

PCでの検証後、スマホ実機で最終確認

- [ ] スマホブラウザ（Safari / Chrome）でアクセス
- [ ] 位置情報の許可ダイアログ → 許可後にマッチング動作
- [ ] 位置情報を拒否 → グッズ登録はできるがマッチングは不可
- [ ] 通知音が鳴る（画面をバックグラウンドにした状態でも確認）
- [ ] UI崩れがないか（各画面をスクロールして確認）
- [ ] PWA的な動作（ホーム画面に追加した場合）
